<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Parqueadero</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <div class="container text-center">
        <div class="mb-2 border border-secondary text-center mt-5 d-flex align-items-center">
            <img src="LOGOU.png" alt="Logo" class="me-3 ms-4" style="width: 50px; height: auto;">
            <div>
                <div class="fs-2 fw-bolder ms-3">Cicloparqueadero</div>
                <div class="fs-6 fw-bolder mb-2 ms-3">Universidad del Rosario</div>
            </div>
        </div>
        <div><h4>Bienvenido juan@urosario.edu.co</h4></div>
        <div>
            <a href="PaginaPri.html">
                <p class="text-end me-5">Salir</p>
            </a>
        </div>
        <div class="fs-2 text-start ms-3 mb-2 mt-2 fw-bolder">+ Entrada</div>
        <div class="text-start ms-3"><p>Favor colocar el codigo numerico que sale en la parte superior y elegir el color correspondiente</p></div>
        
        <div class="form-floating mb-3 ms-3">
            <input type="email" class="form-control" id="nombre" placeholder="name@example.com">
            <label for="floatingInput">Ingrese el codigo</label> 
        </div>
        <div class="form-floating mb-3 ms-3">
            <select class="form-select" id="inputGroupSelect01">
                <option selected>Seleccione el color</option>
                <option value="1">Verde</option>
                <option value="2">Amarillo</option>
                <option value="3">Azul</option>
                <option value="4">Rojo</option>
                <option value="5">Morado</option>
            </select>
        </div>
        <div class="form-floating mb-3 ms-3">
            <select class="form-select" id="inputGroupSelect02">
                <option selected>Seleccione el Cicloparqueadero</option>
                <option value="1">Parqueadero A</option>
                <option value="2">Parqueadero B</option>
            </select>
        </div>

        <div class="button group btn-group-lg mt-2 d-grid gap-2 ms-3">
            <button type="button" id="registrar" class="btn btn-outline-primary mt-2 mb-4 fs-6" onclick="verificarUbicacion()">Registrar entrada</button>
        </div>

        <script>
            // Coordenadas de referencia (Universidad del Rosario)
            const latA = 4.601025504132103;
            const lngA = -74.07303884639771;
            const rangoMaximo = 0.01; // 10 metros = 0.01 km

            // Función para calcular la distancia entre dos coordenadas (en km)
            function calcularDistancia(lat1, lon1, lat2, lon2) {
                const radioTierra = 6371; // Radio de la Tierra en km
                const dLat = deg2rad(lat2 - lat1);
                const dLon = deg2rad(lon2 - lon1);
                const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return radioTierra * c; // Distancia en km
            }

            function deg2rad(deg) {
                return deg * (Math.PI / 180);
            }

            // Función para obtener la ubicación del usuario
            function obtenerUbicacion() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(mostrarUbicacion, manejarError);
                } else {
                    alert("La geolocalización no es soportada por este navegador.");
                }
            }

            // Función para mostrar la ubicación del usuario y verificar si está en el rango
            function mostrarUbicacion(position) {
                const latB = position.coords.latitude;
                const lngB = position.coords.longitude;

                const distancia = calcularDistancia(latA, lngA, latB, lngB);

                // Verificar si la distancia es menor o igual a 10 metros (0.01 km)
                if (distancia <= rangoMaximo) {
                    alert('¡Ubicación válida! Estás dentro del rango.');
                    realizarAccion(true);
                } else {
                    alert('Error: Estás fuera del rango permitido.');
                    realizarAccion(false);
                }
            }

            function realizarAccion(ubicacionValida) {
                if (ubicacionValida) {
                    // Si está dentro del rango, registrar la entrada o redirigir
                    alert("Redirigiéndote a la siguiente página...");
                    window.location.href = "pagina_de_exito.html"; // Cambia esta URL según lo necesario
                } else {
                    // Si está fuera del rango, mostrar un error
                    alert("Por favor, acércate a la Universidad y vuelve a intentarlo.");
                    location.reload();
                }
            }

            function manejarError(error) {
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        alert("El usuario ha denegado el acceso a la ubicación.");
                        break;
                    case error.POSITION_UNAVAILABLE:
                        alert("La ubicación no está disponible.");
                        break;
                    case error.TIMEOUT:
                        alert("Se agotó el tiempo para obtener la ubicación.");
                        break;
                    case error.UNKNOWN_ERROR:
                        alert("Ocurrió un error desconocido.");
                        break;
                }
            }

            // Función que se ejecuta al hacer clic en "Registrar entrada"
            function verificarUbicacion() {
                obtenerUbicacion(); // Llama a la función para obtener la ubicación
            }
        </script>
    </div>
</body>
</html>
